<#include "/skin/plugins/asynchronousupload/upload_commons.html" />
<@addRequiredJsFiles />
<script type="text/javascript" src="jsp/site/plugins/asynchronousupload/GetMainUploadJs.jsp?handler=formsAsynchronousUploadHandler" ></script>

<form class="form-horizontal" id="form-validate" action="jsp/site/Portal.jsp?page=forms" method="post" enctype="multipart/form-data">
	<#if messageInfo?? >
	<div class="alert alert-info" role="alert">
		${messageInfo}
	</div>
	</#if>
	<nav aria-label="breadcrumb">
	  <ol class="breadcrumb">
	  	<#list formBreadcrumb as step>
		  	<#if step?has_next>
		  		<li class="breadcrumb-item">${step.title}</li>
		  	<#else>
		  		<li class="breadcrumb-item active" aria-current="page">${step.title}</li>
		  	</#if>
	  	</#list>
	  </ol>
	</nav>
	${stepContent}
	<div class="form-group">
		<input name="page" value="forms" type="hidden">
		<input name="formId" value="${step.idForm}" type="hidden">
		
		<#if !step.initial ><button class="btn btn-primary btn-sm" name="action_doReturnStep"  type="submit" >#i18n{forms.step.previous}</button></#if>
		<button class="btn btn-primary btn-sm" name="action_doSaveStep"  type="submit"><#if step.final >#i18n{forms.step.save}<#else>#i18n{forms.step.next}</#if></button>
		<#if user?? ><button class="btn btn-info btn-sm pull-right" name="action_doSaveResponse"  type="submit" >#i18n{forms.step.saveResponse}</button></#if>
	</div>
</form>
<script>

	function getInputElement(displayControl)
	{
		var types = ['input','select','textarea'];
		var elm = null;
		for(var i=0;i<types.length && (elm == undefined || elm == null || elm.length <=0);i++)
		{
			elm = $("div[displayControl=" + displayControl + "]").find(types[i]);
		}
		
		if(elm.is('input'))
		{
			elm = $('input[name=' + elm.attr('name') + ']');
		}
		return elm;
	}

	function getFieldValue(elm)
	{
		var result = '';
		if(elm.is(':radio'))
		{
			var input = $('input[name=' + elm.attr('name') + ']:checked');
			result = input.val();
		}
		//add other specific implementations here
		else
		{
			result = elm.val();
		}
		return result;
	}
	
	<#assign validNames = [] />
	<#list list_validators as validator >
		<#if !validNames?seq_contains(validator.validatorBeanName)>
			<#assign validNames = validNames + [validator.validatorBeanName] />
			function validator_${validator.validatorBeanName?replace('.','_')}(${inputValue},${controlValue})
			{
				${validator.getJavascriptValidation()!'return true;'}
			}
		</#if>
	</#list>
	
	<#list list_controls as control>
	var input${control.id} = getInputElement(${control.idQuestion});
		input${control.id}.change(function(){
		var inputValue = getFieldValue(input${control.id});
		if(validator_${control.validatorName?replace('.','_')}( inputValue, '${control.value}'))
		{
			$('.display_field_${control.idTargetFormDisplay!''}').show();		
		}
		else
		{
			$('.display_field_${control.idTargetFormDisplay!''}').hide();
		}
	});
	input${control.id}.change();
	
	</#list>
</script>